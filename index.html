<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life Archives</title>
    
    <!-- Google Fonts: Noto Sans TC (æ€æºé»‘é«”) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ç³»çµ±è¨ºæ–·è…³æœ¬ -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            if (msg.includes("ResizeObserver")) return;
            const consoleDiv = document.getElementById('sys-console');
            if (consoleDiv) {
                consoleDiv.style.display = 'block';
                const err = document.createElement('div');
                err.style.color = '#ef4444';
                err.innerHTML = `<strong>[SYSTEM ERROR]:</strong> ${msg}`;
                consoleDiv.appendChild(err);
            }
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: none;
            /* å­—é«”å„ªåŒ–ï¼šå„ªå…ˆä½¿ç”¨ Noto Sans TC (æ€æºé»‘é«”) */
            font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", "Heiti TC", sans-serif;
            font-weight: 400;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(16, 185, 129, 0.3); border-radius: 2px; }
        
        .scan-line { 
            position: fixed; top: 0; left: 0; width: 100%; height: 2px; 
            background: rgba(16, 185, 129, 0.3); 
            animation: scan 3s linear infinite; pointer-events: none; z-index: 50; opacity: 0.3; 
        }
        @keyframes scan { 0% { transform: translateY(-100vh); } 100% { transform: translateY(100vh); } }
        
        input, textarea, select { font-size: 16px; font-family: inherit; } 

        #sys-console {
            display: none;
            position: fixed; top: 60px; left: 20px; right: 20px;
            background: rgba(15, 23, 42, 0.95); border: 1px solid #ef4444;
            padding: 20px; border-radius: 8px; z-index: 9999;
            font-family: monospace; font-size: 14px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="sys-console"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Book, MapPin, Star, Calendar, Trash2, Plus, 
            ChevronDown, ChevronUp, Image as ImageIcon, Map,
            Filter, Archive, Coffee, Heart, Globe, LogIn, LogOut,
            User, Settings, Lightbulb, X, ExternalLink, MessageSquare,
            Layout, GitMerge, FileText
        } from 'lucide-react';
        
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query, orderBy, where } from 'firebase/firestore';

        // =================================================================================
        // â–¼â–¼â–¼ ä½¿ç”¨è€…è¨­å®šå€ (è«‹å¡«å…¥æ‚¨çš„è³‡æ–™åº«è¨­å®š) â–¼â–¼â–¼
        // =================================================================================
        
        const myFirebaseConfig = {
 apiKey: "AIzaSyAgNktz8JUCOglOtB-zyle-FSfIV0TbVRc",
  authDomain: "blackbox-48253.firebaseapp.com",
  projectId: "blackbox-48253",
  storageBucket: "blackbox-48253.firebasestorage.app",
  messagingSenderId: "349317379720",
  appId: "1:349317379720:web:e006daa4643c5310ebd13d"
        };

        // =================================================================================

        const firebaseConfig = (typeof __firebase_config !== 'undefined') ? JSON.parse(__firebase_config) : myFirebaseConfig;
        
        let app, auth, db;
        const provider = new GoogleAuthProvider();
        try {
            if (Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey) {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            }
        } catch (e) { console.error("Firebase init failed:", e); }

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'life-archives-standalone';

        // --- Mock Data ---
        const MOCK_ARCHIVES = [
            { 
                id: 'm1', 
                title: 'æ±äº¬ç¨æ—…ï¼šè—ç“¶å’–å•¡', 
                date: '2023-11-15', 
                type: 'travel', 
                content: 'é™½å…‰ç‘ä¸‹ä¾†çš„æ™‚å€™è¦ºå¾—ä¸–ç•Œå¾ˆå®‰éœï¼Œé‚£æ˜¯ä¹…é•çš„æ”¾é¬†æ„Ÿã€‚', 
                tags: ['Tokyo', 'Coffee'],
                retrospectives: []
            },
            { 
                id: 'm2', 
                title: 'å‡è·é€™ä¸€å¤©', 
                date: '2022-06-20', 
                type: 'milestone', 
                content: 'é›–ç„¶å¾ˆç´¯ï¼Œä½†è­‰æ˜äº†è‡ªå·±æ˜¯æœ‰èƒ½åŠ›çš„ã€‚', 
                tags: ['Career'],
                retrospectives: [{note: 'ç¾åœ¨å›é ­çœ‹ï¼Œé‚£æ™‚å€™çš„ç„¦æ…®å…¶å¯¦éƒ½æ˜¯æˆé•·çš„é¤Šåˆ†ã€‚', timestamp: '2024-01-01T12:00:00.000Z'}]
            },
        ];

        const CATEGORIES = {
            travel: { label: 'æ—…éŠç­†è¨˜', icon: Globe, color: 'text-emerald-400', border: 'border-emerald-500/30', bg: 'bg-emerald-500/10' },
            milestone: { label: 'äººç”Ÿå¤§äº‹', icon: Star, color: 'text-amber-400', border: 'border-amber-500/30', bg: 'bg-amber-500/10' },
            memory: { label: 'å›æ†¶ç¢ç‰‡', icon: Book, color: 'text-indigo-400', border: 'border-indigo-500/30', bg: 'bg-indigo-500/10' },
            love: { label: 'æƒ…æ„Ÿæ™‚åˆ»', icon: Heart, color: 'text-rose-400', border: 'border-rose-500/30', bg: 'bg-rose-500/10' }
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [archives, setArchives] = useState([]);
            const [loading, setLoading] = useState(true);
            
            // UI States
            const [isAdding, setIsAdding] = useState(false);
            const [showPhilosophy, setShowPhilosophy] = useState(false); 
            const [philosophyTab, setPhilosophyTab] = useState('protocol'); // 'protocol' | 'architecture' | 'relationship'
            
            // Input States
            const [newTitle, setNewTitle] = useState('');
            const [newDate, setNewDate] = useState(new Date().toISOString().split('T')[0]);
            const [newType, setNewType] = useState('travel');
            const [newContent, setNewContent] = useState('');
            const [newTags, setNewTags] = useState('');

            // Retrospective States
            const [retroInputId, setRetroInputId] = useState(null);
            const [retroText, setRetroText] = useState('');

            // Filter State
            const [filterType, setFilterType] = useState('all');

            // Auth
            useEffect(() => {
                if(!auth) { 
                    setArchives(MOCK_ARCHIVES);
                    setLoading(false); 
                    return; 
                }
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    if (!currentUser) {
                        setArchives(MOCK_ARCHIVES);
                        setLoading(false);
                    }
                });
                return () => unsubscribe();
            }, []);

            // Data Fetching
            useEffect(() => {
                if(!user || !db) return;
                
                const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'archives'), orderBy('date', 'desc'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const loaded = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setArchives(loaded);
                    setLoading(false);
                }, (error) => {
                    console.error("Error fetching archives:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            const handleLogin = async () => {
                if (!auth) return alert("Firebase è¨­å®šæœªå¡«å¯«");
                try { await signInWithPopup(auth, provider); } catch (e) { 
                     if (e.code !== 'auth/unauthorized-domain' && e.code !== 'auth/popup-closed-by-user') {
                         alert(`ç™»å…¥å¤±æ•—: ${e.message}`);
                    }
                }
            };
            const handleLogout = async () => { if(auth) await signOut(auth); };

            const addArchive = async () => {
                if (!newTitle.trim() || !newContent.trim()) return;
                
                const entry = {
                    title: newTitle,
                    date: newDate,
                    type: newType,
                    content: newContent,
                    tags: newTags.split(',').map(t => t.trim()).filter(t => t),
                    createdAt: serverTimestamp(),
                    retrospectives: []
                };

                if (db && user) {
                    await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'archives'), entry);
                } else {
                    setArchives(prev => [{id: Date.now(), ...entry}, ...prev]);
                }
                
                // Reset form
                setNewTitle('');
                setNewContent('');
                setNewTags('');
                setIsAdding(false);
            };

            const deleteArchive = async (id) => {
                if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™æ®µå›æ†¶å—ï¼Ÿ")) return;
                if (db && user && !id.toString().startsWith('m')) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'archives', id));
                } else {
                    setArchives(prev => prev.filter(a => a.id !== id));
                }
            };

            const handleAddRetro = async (archiveId) => {
                if (!retroText.trim()) return;
                
                if (db && user && !archiveId.toString().startsWith('m')) {
                    const archiveRef = doc(db, 'artifacts', appId, 'users', user.uid, 'archives', archiveId);
                    const currentArchive = archives.find(a => a.id === archiveId);
                    const currentRetros = currentArchive.retrospectives || [];
                    
                    await updateDoc(archiveRef, {
                        retrospectives: [...currentRetros, { note: retroText, timestamp: new Date().toISOString() }]
                    });
                } else {
                    // Mock update
                    setArchives(prev => prev.map(a => {
                        if (a.id === archiveId) {
                            return { ...a, retrospectives: [...(a.retrospectives || []), { note: retroText, timestamp: new Date().toISOString() }] };
                        }
                        return a;
                    }));
                }
                setRetroInputId(null);
                setRetroText('');
            };

            const filteredArchives = filterType === 'all' 
                ? archives 
                : archives.filter(a => a.type === filterType);

            // Group by Year
            const groupedArchives = filteredArchives.reduce((acc, curr) => {
                const year = curr.date.split('-')[0];
                if (!acc[year]) acc[year] = [];
                acc[year].push(curr);
                return acc;
            }, {});

            const sortedYears = Object.keys(groupedArchives).sort((a, b) => b - a);

            if (loading) return <div className="h-screen bg-slate-950 flex items-center justify-center text-emerald-500 font-mono">ARCHIVE LOADING...</div>;

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-mono pb-20 relative">
                    <div className="scan-line"></div>

                    {/* Header */}
                    <div className="sticky top-0 z-40 bg-slate-950/80 backdrop-blur border-b border-emerald-900/50 p-4 flex justify-between items-center">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-emerald-500/10 rounded border border-emerald-500/30"><Archive className="text-emerald-400" size={20} /></div>
                            <div>
                                <h1 className="text-lg font-bold tracking-widest text-emerald-400">LIFE ARCHIVES</h1>
                                <p className="text-[10px] text-slate-500">{user ? user.email : 'LEGACY STORAGE'}</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            <button onClick={() => setShowPhilosophy(true)} className="text-emerald-400/70 hover:text-emerald-400 p-2 rounded-full hover:bg-emerald-500/10 transition-colors">
                                <Lightbulb size={20} />
                            </button>
                            {user ? (
                                <button onClick={handleLogout}><LogOut size={20} className="text-slate-500 hover:text-white"/></button>
                            ) : (
                                <button onClick={handleLogin} className="flex items-center gap-1 bg-emerald-600/20 text-emerald-400 px-3 py-1 rounded text-xs font-bold border border-emerald-500/30"><LogIn size={12}/> LOGIN</button>
                            )}
                        </div>
                    </div>

                    {/* Add Button & Filter */}
                    <div className="p-4 flex gap-2">
                        <button 
                            onClick={() => setIsAdding(!isAdding)}
                            className={`flex-1 py-3 rounded-lg border flex items-center justify-center gap-2 transition-all ${isAdding ? 'bg-slate-800 border-slate-600' : 'bg-emerald-600 hover:bg-emerald-500 border-transparent text-white'}`}
                        >
                            {isAdding ? <X size={18}/> : <Plus size={18}/>}
                            <span className="font-bold text-sm">{isAdding ? 'å–æ¶ˆ' : 'èƒå–èˆŠç´€éŒ„'}</span>
                        </button>
                        
                        <div className="relative">
                            <select 
                                value={filterType} 
                                onChange={(e) => setFilterType(e.target.value)}
                                className="h-full bg-slate-900 border border-slate-700 rounded-lg px-4 text-xs focus:outline-none appearance-none text-emerald-400"
                            >
                                <option value="all">é¡¯ç¤ºå…¨éƒ¨</option>
                                {Object.entries(CATEGORIES).map(([k, v]) => (
                                    <option key={k} value={k}>{v.label}</option>
                                ))}
                            </select>
                            <Filter size={14} className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"/>
                        </div>
                    </div>

                    {/* Add Form */}
                    {isAdding && (
                        <div className="mx-4 mb-6 p-4 bg-slate-900 border border-emerald-500/30 rounded-xl animate-in slide-in-from-top-4">
                            <div className="space-y-3">
                                <div className="flex gap-2">
                                    <input 
                                        type="date" 
                                        value={newDate} 
                                        onChange={e => setNewDate(e.target.value)}
                                        className="bg-slate-950 border border-slate-700 rounded px-3 py-2 text-sm w-1/3"
                                    />
                                    <select 
                                        value={newType} 
                                        onChange={e => setNewType(e.target.value)}
                                        className="bg-slate-950 border border-slate-700 rounded px-3 py-2 text-sm flex-1"
                                    >
                                        {Object.entries(CATEGORIES).map(([k, v]) => (
                                            <option key={k} value={k}>{v.label}</option>
                                        ))}
                                    </select>
                                </div>
                                <input 
                                    type="text" 
                                    value={newTitle} 
                                    onChange={e => setNewTitle(e.target.value)}
                                    placeholder="æ¨™é¡Œ (ä¾‹å¦‚ï¼šæ±äº¬ä¹‹æ—…ã€ç¬¬ä¸€ä»½å·¥ä½œ...)"
                                    className="w-full bg-slate-950 border border-slate-700 rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none"
                                />
                                <textarea 
                                    value={newContent} 
                                    onChange={e => setNewContent(e.target.value)}
                                    placeholder="è¨˜éŒ„ç•¶ä¸‹çš„æ„Ÿå—ã€é€™æ®µå›æ†¶ç‚ºä»€éº¼é‡è¦..."
                                    className="w-full bg-slate-950 border border-slate-700 rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none h-24"
                                />
                                <input 
                                    type="text" 
                                    value={newTags} 
                                    onChange={e => setNewTags(e.target.value)}
                                    placeholder="æ¨™ç±¤ (ä»¥é€—è™Ÿåˆ†éš”ï¼Œä¾‹å¦‚ï¼šæ—¥æœ¬, ç¨æ—…)"
                                    className="w-full bg-slate-950 border border-slate-700 rounded px-3 py-2 text-xs"
                                />
                                <button onClick={addArchive} className="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-2 rounded font-bold text-sm">
                                    å­˜å…¥æª”æ¡ˆé¤¨
                                </button>
                                <p className="text-[10px] text-slate-500 text-center mt-2">
                                    * è¼¸å…¥å®Œç•¢å¾Œï¼Œå»ºè­°ç›´æ¥å°‡ç´™æœ¬è¨˜éŒ„ä¸Ÿæ£„æˆ–å°å­˜ã€‚
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Timeline */}
                    <div className="px-4 space-y-8">
                        {sortedYears.map(year => (
                            <div key={year} className="relative">
                                <div className="sticky top-16 z-30 py-2 bg-slate-950/90 backdrop-blur w-full border-b border-slate-800 mb-4 flex items-center gap-2">
                                    <span className="text-2xl font-black text-slate-500">{year}</span>
                                    <div className="h-[1px] bg-slate-800 flex-1"></div>
                                </div>
                                
                                <div className="space-y-4 pl-4 border-l-2 border-slate-800 ml-2">
                                    {groupedArchives[year].map(archive => {
                                        const cat = CATEGORIES[archive.type] || CATEGORIES.memory;
                                        const Icon = cat.icon;
                                        return (
                                            <div key={archive.id} className={`relative bg-slate-900 border ${cat.border} p-4 rounded-xl group transition-all hover:bg-slate-800`}>
                                                {/* Dot on timeline */}
                                                <div className={`absolute -left-[25px] top-4 w-4 h-4 rounded-full border-2 bg-slate-950 flex items-center justify-center ${cat.border.replace('border', 'border-')}`}>
                                                    <div className={`w-1.5 h-1.5 rounded-full ${cat.bg.replace('bg-', 'bg-').replace('/10', '')}`}></div>
                                                </div>
                                                
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex items-center gap-2">
                                                        <Icon size={16} className={cat.color} />
                                                        <span className={`text-xs font-bold px-2 py-0.5 rounded ${cat.bg} ${cat.color}`}>{cat.label}</span>
                                                        <span className="text-xs text-slate-500">{archive.date}</span>
                                                    </div>
                                                    <button onClick={() => deleteArchive(archive.id)} className="text-slate-600 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-opacity"><Trash2 size={14}/></button>
                                                </div>
                                                
                                                <h3 className="text-base font-bold text-white mb-2">{archive.title}</h3>
                                                <p className="text-sm text-slate-300 leading-relaxed whitespace-pre-wrap">{archive.content}</p>
                                                
                                                {archive.tags && archive.tags.length > 0 && (
                                                    <div className="flex flex-wrap gap-2 mt-3 pt-3 border-t border-slate-800">
                                                        {archive.tags.map((tag, i) => (
                                                            <span key={i} className="text-[10px] text-slate-500">#{tag}</span>
                                                        ))}
                                                    </div>
                                                )}

                                                {/* Retrospectives Section */}
                                                <div className="mt-4 pt-3 border-t border-slate-800/50">
                                                    {archive.retrospectives && archive.retrospectives.map((retro, idx) => (
                                                        <div key={idx} className="text-xs text-indigo-300 mb-2 pl-2 border-l-2 border-indigo-500/50">
                                                            <span className="opacity-50 mr-2">[{new Date(retro.timestamp).toLocaleDateString()}]</span>
                                                            {retro.note}
                                                        </div>
                                                    ))}

                                                    <button 
                                                        onClick={() => setRetroInputId(retroInputId === archive.id ? null : archive.id)}
                                                        className="text-[10px] text-slate-500 hover:text-emerald-400 flex items-center gap-1 transition-colors mt-2"
                                                    >
                                                        <MessageSquare size={12} /> å¯«ä¸‹æ–°è§€é»
                                                    </button>

                                                    {retroInputId === archive.id && (
                                                        <div className="mt-2 flex gap-2 animate-in fade-in">
                                                            <input 
                                                                autoFocus
                                                                type="text" 
                                                                value={retroText}
                                                                onChange={e => setRetroText(e.target.value)}
                                                                placeholder="ç¾åœ¨å›é ­çœ‹ï¼Œæœ‰ä»€éº¼æ–°æƒ³æ³•ï¼Ÿ"
                                                                className="flex-1 bg-slate-950 border border-slate-700 rounded px-2 py-1 text-xs focus:outline-none focus:border-emerald-500"
                                                                onKeyDown={e => e.key === 'Enter' && handleAddRetro(archive.id)}
                                                            />
                                                            <button onClick={() => handleAddRetro(archive.id)} className="bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1 rounded text-xs">ç¢ºèª</button>
                                                        </div>
                                                    )}
                                                </div>

                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ))}
                        
                        {sortedYears.length === 0 && !loading && (
                            <div className="text-center py-20 text-slate-600">
                                <p className="mb-2">ARCHIVE EMPTY</p>
                                <p className="text-xs">é€™è£¡ç©ºç©ºå¦‚ä¹Ÿã€‚è©¦è‘—è¼¸å…¥ä¸€å‰‡ä½ æœ€çè²´çš„å›æ†¶å§ã€‚</p>
                            </div>
                        )}
                    </div>

                    {/* Philosophy Modal (Updated with Tabs) */}
                    {showPhilosophy && (
                        <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in">
                            <div className="bg-slate-900 border border-emerald-500/30 rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden relative flex flex-col max-h-[85vh]">
                                <button onClick={() => setShowPhilosophy(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white z-10"><X size={24} /></button>
                                
                                <div className="p-8 pb-4 text-center border-b border-emerald-900/30">
                                    <div className="w-12 h-12 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <Lightbulb size={24} className="text-emerald-400" />
                                    </div>
                                    <h2 className="text-lg font-bold text-white">æª”æ¡ˆé¤¨å®ˆå‰‡</h2>
                                </div>

                                {/* Tabs */}
                                <div className="flex border-b border-emerald-900/30 bg-slate-900/50">
                                    <button 
                                        onClick={() => setPhilosophyTab('protocol')}
                                        className={`flex-1 py-3 text-xs font-bold transition-colors ${philosophyTab === 'protocol' ? 'text-emerald-400 border-b-2 border-emerald-400' : 'text-slate-500'}`}
                                    >
                                        æ ¸å¿ƒå®ˆå‰‡
                                    </button>
                                    <button 
                                        onClick={() => setPhilosophyTab('architecture')}
                                        className={`flex-1 py-3 text-xs font-bold transition-colors ${philosophyTab === 'architecture' ? 'text-indigo-400 border-b-2 border-indigo-400' : 'text-slate-500'}`}
                                    >
                                        ç³»çµ±æ¶æ§‹åˆ†æ
                                    </button>
                                </div>
                                
                                <div className="p-6 overflow-y-auto custom-scrollbar flex-1">
                                    {philosophyTab === 'protocol' && (
                                        <div className="space-y-6 text-left animate-in fade-in">
                                            {/* Core Philosophy */}
                                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                                <h3 className="text-emerald-400 font-bold text-sm mb-2">æ ¸å¿ƒç†å¿µ</h3>
                                                <p className="text-slate-300 text-sm leading-relaxed">
                                                    ã€Œç¾åœ¨é–‹å§‹ï¼Œä¸è¦ã€å¯«ã€æ—¥è¨˜ï¼Œæ”¹ç‚ºã€ç•™ã€ç·šç´¢ã€‚ã€<br/><br/>
                                                    æŠŠé€™è£¡ç•¶ä½œæ¯å­£æˆ–æ¯å¹´çš„ã€Œç­–å±•ã€ã€‚å¹³æ™‚åªè² è²¬ä¸ŸéºµåŒ…å±‘ï¼ˆç…§ç‰‡ã€é—œéµå­—ï¼‰ï¼Œç­‰åˆ°çœŸçš„æœ‰ç©ºã€æœ‰å¿ƒæƒ…æ™‚ï¼Œå†æŠŠé‡è¦çš„ç²¾è¯æ”¾é€²ä¾†ã€‚
                                                </p>
                                            </div>

                                            {/* Google Calendar Strategy */}
                                            <div className="bg-blue-900/20 p-4 rounded-xl border border-blue-500/30">
                                                <h3 className="text-blue-400 font-bold text-sm mb-2 flex items-center gap-2">
                                                    <Calendar size={14}/> éºµåŒ…å±‘æˆ°ç•¥ (Google Calendar)
                                                </h3>
                                                <ul className="text-slate-300 text-xs leading-relaxed list-disc pl-4 space-y-1">
                                                    <li><strong>æ—¥å¸¸ (Daily):</strong> ä¸å¯«æ—¥è¨˜ã€‚åªåœ¨è¡Œäº‹æ›†ä¸Šæ‰“ 3 å€‹é—œéµå­— (ä¾‹å¦‚: #è¢«ç½µ #æƒ³é›¢è·)ã€‚</li>
                                                    <li><strong>å›é¡§ (Review):</strong> æ•´ç†æª”æ¡ˆé¤¨æ™‚ï¼Œæœå°‹è¡Œäº‹æ›†é—œéµå­—ï¼Œç¬é–“å–šé†’è¨˜æ†¶ã€‚</li>
                                                </ul>
                                                <a 
                                                    href="https://calendar.google.com/" 
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="mt-3 flex items-center justify-center gap-2 w-full py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors"
                                                >
                                                    <ExternalLink size={12}/> æ‰“é–‹ Google Calendar
                                                </a>
                                            </div>

                                            {/* Triggers */}
                                            <div className="grid grid-cols-2 gap-3">
                                                <div className="bg-slate-800/50 p-3 rounded-lg border border-slate-700">
                                                    <h4 className="text-amber-400 font-bold text-xs mb-1">ä»€éº¼æ™‚å€™è¨˜? (Capture)</h4>
                                                    <p className="text-slate-400 text-[10px]">Type A éœ‡æ’¼å½ˆï¼šç•¶ä¸‹ç«‹åˆ»è¨˜ï¼ˆé›¢è·ã€åˆ†æ‰‹ã€éŒ„å–ï¼‰ã€‚</p>
                                                </div>
                                                <div className="bg-slate-800/50 p-3 rounded-lg border border-slate-700">
                                                    <h4 className="text-amber-400 font-bold text-xs mb-1">ä»€éº¼æ™‚å€™æ›´æ–°? (Update)</h4>
                                                    <p className="text-slate-400 text-[10px]">ç•¶ä½ ç”¢ç”Ÿã€Œå…±é³´ã€æ™‚ï¼Œæˆ–ä¸€å€‹äººç”Ÿç« ç¯€çµæŸæ™‚ã€‚</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {philosophyTab === 'architecture' && (
                                        <div className="space-y-6 text-left animate-in fade-in">
                                            {/* Architecture Analysis Table */}
                                            <div className="overflow-hidden rounded-xl border border-slate-700">
                                                <table className="w-full text-xs text-left">
                                                    <thead className="bg-slate-800 text-slate-400">
                                                        <tr>
                                                            <th className="p-3">ç‰¹å¾µ</th>
                                                            <th className="p-3 text-emerald-400">èˆªè¡Œæ—¥èªŒ</th>
                                                            <th className="p-3 text-indigo-400">ç”Ÿå‘½æª”æ¡ˆé¤¨</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-slate-800 bg-slate-900/50 text-slate-300">
                                                        <tr><td className="p-3 font-bold text-slate-500">æ¯”å–»</td><td className="p-3">ä¾¿åˆ©è²¼</td><td className="p-3">å±•è¦½å“</td></tr>
                                                        <tr><td className="p-3 font-bold text-slate-500">è¦–è§’</td><td className="p-3">é£›è¡Œå“¡</td><td className="p-3">ç­–å±•äºº</td></tr>
                                                        <tr><td className="p-3 font-bold text-slate-500">é »ç‡</td><td className="p-3">é«˜é » (éš¨æ™‚)</td><td className="p-3">ä½é » (æ¯å­£)</td></tr>
                                                        <tr><td className="p-3 font-bold text-slate-500">é•·åº¦</td><td className="p-3">çŸ­ (é—œéµå­—)</td><td className="p-3">é•· (æ•…äº‹)</td></tr>
                                                        <tr><td className="p-3 font-bold text-slate-500">ç”¨é€”</td><td className="p-3">å°èˆª</td><td className="p-3">å®šä½</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            {/* Unified Funnel Logic (Including Duo Mode) */}
                                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                                <h3 className="text-emerald-400 font-bold text-sm mb-3 flex items-center gap-2">
                                                    <GitMerge size={14}/> é€šç”¨æ¼æ–—é‚è¼¯ (Universal Funnel)
                                                </h3>
                                                <p className="text-xs text-slate-300 mb-4 leading-relaxed">
                                                    ç„¡è«–æ˜¯æ—¥å¸¸ç‘£äº‹ã€æˆ€æ„›é»æ»´é‚„æ˜¯æ—…è¡Œè¦‹èï¼Œè™•ç†çš„é‚è¼¯æ˜¯ä¸€è‡´çš„ï¼š<strong>å…ˆæ•æ‰ç¢ç‰‡ï¼Œå†èƒå–æ„ç¾©ã€‚</strong>
                                                </p>
                                                
                                                {/* Scenario Matrix */}
                                                <div className="overflow-hidden rounded-lg border border-slate-600">
                                                    <table className="w-full text-xs text-left">
                                                        <thead className="bg-slate-700 text-slate-300">
                                                            <tr>
                                                                <th className="p-2">æƒ…å¢ƒ</th>
                                                                <th className="p-2">ç¬¬ä¸€å±¤ï¼šæ•æ‰ (ç•¶ä¸‹)</th>
                                                                <th className="p-2">ç¬¬äºŒå±¤ï¼šç­–å±• (å›é¡§)</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-slate-700 bg-slate-800 text-slate-400">
                                                            <tr>
                                                                <td className="p-2 font-bold text-slate-300">æ—¥å¸¸</td>
                                                                <td className="p-2">Google Calendar (é—œéµå­—)</td>
                                                                <td className="p-2">äººç”Ÿå¤§äº‹ / éšæ®µç¸½çµ</td>
                                                            </tr>
                                                            <tr>
                                                                <td className="p-2 font-bold text-rose-300">æˆ€æ„›</td>
                                                                <td className="p-2">èˆªè¡Œæ—¥èªŒ (ç³–æœç½)</td>
                                                                <td className="p-2">æ„›æƒ…æ•…äº‹ (å…±åŒæ­·å²)</td>
                                                            </tr>
                                                            <tr>
                                                                <td className="p-2 font-bold text-indigo-300">æ—…éŠ</td>
                                                                <td className="p-2">èˆªè¡Œæ—¥èªŒ (æ‰“å¡é»)</td>
                                                                <td className="p-2">æ—…è¡Œå›æ†¶éŒ„ (æ„ç¾©)</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            {/* Usage Scenarios */}
                                            <div className="bg-indigo-900/10 p-4 rounded-xl border border-indigo-500/20">
                                                <h3 className="text-indigo-400 font-bold text-sm mb-3 flex items-center gap-2">
                                                    <Archive size={14}/> ä½¿ç”¨æƒ…å¢ƒ (Usage Scenarios)
                                                </h3>
                                                <ul className="text-slate-300 text-xs list-disc pl-4 space-y-2 leading-relaxed">
                                                    <li><strong>æ•´ç†èˆŠç‰©æ™‚ï¼š</strong>æŠŠèˆŠç­†è¨˜æœ¬è£¡ã€Œæ¨ä¸å¾—å¿˜ã€çš„æ•…äº‹è¼¸å…¥é€²å»ï¼Œç„¶å¾ŒæŠŠç´™æœ¬ä¸Ÿæ‰ (èƒå–èˆ‡éŠ·æ¯€)ã€‚</li>
                                                    <li><strong>è¿·æƒ˜æ™‚ï¼š</strong>å›é¡§äººç”Ÿæ™‚é–“è»¸ï¼Œçœ‹çœ‹è‡ªå·±é€™äº”å¹´å®Œæˆäº†å“ªäº›å¤§äº‹ (Milestones)ï¼Œç¢ºèªè‡ªå·±å…¶å¯¦æœ‰åœ¨å‰é€²ã€‚</li>
                                                    <li><strong>å­£åº¦/å¹´åº¦å›é¡§ï¼š</strong>å¾ Google Calendar çš„ã€ŒéºµåŒ…å±‘ã€ä¸­æŒ‘é¸ç²¾è¯ï¼Œè½‰åŒ–ç‚ºæ°¸ä¹…ä¿å­˜çš„æª”æ¡ˆã€‚</li>
                                                </ul>
                                            </div>

                                            {/* Duo Mode Warm Description (Integrated Here) */}
                                            <div className="bg-rose-900/10 p-5 rounded-xl border border-rose-500/20 mt-4">
                                                <h3 className="text-rose-400 font-bold text-sm mb-3 flex items-center gap-2">
                                                    <Heart size={16}/> æ¨è–¦çš„æƒ…ä¾¶å·¥ä½œæµ
                                                </h3>
                                                
                                                <p className="text-xs text-slate-300 mb-6 italic leading-relaxed">
                                                    ã€Œä¸è¦è®“ç´€éŒ„è®Šæˆå£“åŠ›ã€‚é€™æ˜¯ç‚ºäº†å„²å­˜æº«æŸ”ï¼Œè€Œä¸æ˜¯äº¤ä½œæ¥­ã€‚ã€
                                                </p>

                                                <div className="space-y-6">
                                                    {/* Daily */}
                                                    <div className="relative pl-4 border-l-2 border-rose-500/30">
                                                        <div className="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-rose-500"></div>
                                                        <h4 className="text-xs font-bold text-rose-300 mb-1">æ—¥å¸¸ (Daily)ï¼šæ•æ‰å°ç¢ºå¹¸</h4>
                                                        <p className="text-xs text-slate-400 leading-relaxed">
                                                            ç™¼ç”Ÿä»»ä½•è®“ä½ å˜´è§’ä¸Šæšçš„å°äº‹ï¼ˆé€™åªéœ€è¦ 30 ç§’ï¼‰ã€‚<br/>
                                                            <span className="text-rose-400/80">ğŸ‘‰ è¨˜åœ¨ã€Œèˆªè¡Œæ—¥èªŒ (Love Beacons)ã€æˆ–æ‰‹æ©Ÿéš¨æ‰‹æ‹ã€‚</span>
                                                        </p>
                                                    </div>

                                                    {/* Event-based */}
                                                    <div className="relative pl-4 border-l-2 border-indigo-500/30">
                                                        <div className="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-indigo-500"></div>
                                                        <h4 className="text-xs font-bold text-indigo-300 mb-1">ç‰¹æ®Šäº‹ä»¶ (Event)ï¼šå…±åŒçš„æ­·å²</h4>
                                                        <p className="text-xs text-slate-400 leading-relaxed">
                                                            å‰›çµæŸä¸€è¶Ÿå¾ˆæ£’çš„æ—…è¡Œï¼ŸæŒ‘é¸ 3 å¼µæœ€ç²¾è¯çš„ç…§ç‰‡ï¼Œå¯«ä¸‹é€™æ¬¡æ—…è¡Œå°ä½ å€‘çš„æ„ç¾©ï¼ˆä¾‹å¦‚ï¼šã€Œç™¼ç¾æˆ‘å€‘å¾ˆé©åˆä¸€èµ·ç”Ÿæ´»ã€ï¼‰ã€‚<br/>
                                                            <span className="text-indigo-400/80">ğŸ‘‰ æ‰“é–‹ã€Œç”Ÿå‘½æª”æ¡ˆé¤¨ã€æ–°å¢ Travel æª”æ¡ˆã€‚</span>
                                                        </p>
                                                    </div>

                                                    {/* Review */}
                                                    <div className="relative pl-4 border-l-2 border-amber-500/30">
                                                        <div className="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-amber-500"></div>
                                                        <h4 className="text-xs font-bold text-amber-300 mb-1">å›é¡§ (Review)ï¼šæº«æŸ”çš„ç¸½çµ</h4>
                                                        <p className="text-xs text-slate-400 leading-relaxed">
                                                            æ¯å­£æˆ–æ¯å¹´ï¼Œæ‰“é–‹ã€Œèˆªè¡Œæ—¥èªŒã€çœ‹çœ‹é‚£äº›ç´¯ç©çš„å°äº‹ï¼ˆå‰è¦ã€å¹é ­é«®ï¼‰ã€‚å¦³æœƒæ„Ÿå—åˆ°ä¸€è‚¡æš–æµã€‚<br/>
                                                            <span className="text-amber-400/80">ğŸ‘‰ åœ¨æª”æ¡ˆé¤¨å¯«ä¸‹ä¸€ç¯‡ Love ç¸½çµï¼šã€Œ2024å¹´ï¼Œè¬è¬ä½ ä¸€ç›´ä»¥ä¾†çš„æº«æŸ”ã€‚ã€</span>
                                                        </p>
                                                    </div>
                                                </div>

                                                <div className="mt-6 p-3 bg-slate-900/50 rounded border border-rose-500/10 text-center">
                                                    <p className="text-[10px] text-slate-400">
                                                        ç›¸è™•é»æ»´ (å°äº‹) ğŸ‘‰ <span className="text-rose-300">ç•¶ä¸‹çš„é¤Šåˆ†</span><br/>
                                                        æ—…éŠæ—¥èªŒ (å¤§äº‹) ğŸ‘‰ <span className="text-indigo-300">å…±åŒçš„æ­·å²</span>
                                                    </p>
                                                </div>
                                            </div>

                                            {/* Execution Strategy Funnel */}
                                            <div className="space-y-3 mt-4">
                                                {[
                                                    {layer: "ç¬¬ä¸€å±¤ï¼šéºµåŒ…å±‘ (Breadcrumbs)", tool: "Google Calendar / Waypoints", color: "slate", action: "æ—¥å¸¸éš¨æ‰‹è¨˜", content: "é—œéµå­—ã€åœ°é»ã€ç…§ç‰‡", purpose: "ç•™ä¸‹ç·šç´¢ï¼Œä¸è®“è¨˜æ†¶æ†‘ç©ºæ¶ˆå¤±"},
                                                    {layer: "ç¬¬äºŒå±¤ï¼šç­–å±•èˆ‡èƒå– (Curation)", tool: "Life Archives", color: "indigo", action: "æ¯å­£ä¸€æ¬¡ï¼Œæ‰“é–‹ç¬¬ä¸€å±¤å›é¡§", content: "æŒ‘é¸ 3-5 å€‹ã€Œå®šç¾©é€™æ®µæ™‚é–“ã€çš„ç²¾è¯äº‹ä»¶", purpose: "è³¦äºˆæ„ç¾©ï¼Œå°å­˜è¨˜æ†¶"},
                                                    {layer: "ç¬¬ä¸‰å±¤ï¼šéŠ·æ¯€èˆ‡æ”¾ä¸‹ (Release)", tool: "Trash Can", color: "rose", action: "ç¢ºèªå­˜å…¥å¾Œï¼Œä¸Ÿæ‰èˆŠç­†è¨˜", content: "ç‰©ç†éŠ·æ¯€æˆ–æ•¸ä½å°å­˜", purpose: "è¼•é‡åŒ–äººç”Ÿï¼Œå°ˆæ³¨ç•¶ä¸‹é£›è¡Œ"}
                                                ].map((step, i) => (
                                                    <div key={i} className={`p-3 rounded border border-${step.color}-500/30 bg-${step.color}-500/5`}>
                                                        <div className={`font-bold text-${step.color}-400 text-xs mb-2`}>
                                                            <span className="mr-2 border border-current px-1.5 rounded text-[10px]">{i+1}</span>
                                                            {step.layer}
                                                        </div>
                                                        <div className="space-y-1 pl-6">
                                                            <div className="text-[10px] text-slate-300"><span className="text-slate-500 font-bold">å‹•ä½œï¼š</span>{step.action}</div>
                                                            <div className="text-[10px] text-slate-300"><span className="text-slate-500 font-bold">å…§å®¹ï¼š</span>{step.content}</div>
                                                            <div className="text-[10px] text-slate-300"><span className="text-slate-500 font-bold">ç›®çš„ï¼š</span>{step.purpose}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                        </div>
                                    )}

                                    <button onClick={() => setShowPhilosophy(false)} className="mt-8 w-full bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-xl font-bold text-sm transition-colors">
                                        éŠ˜è¨˜åœ¨å¿ƒ (ACKNOWLEDGED)
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
